{:paths ["scripts"]
 :deps {io.github.matthewdowney/rich-comment-tests {:git/tag "v1.0.3" :git/sha "a8711e9"}}
 :tasks
 {:requires ([tasks]
             [recipes]
             [process-inspect]
             [com.mjdowney.rich-comment-tests.test-runner :as rct])

  ;; === CAPTURE (write snapshots to ~/mem-debug/snaps/) ===
  snap          {:doc "CAPTURE: 'Feels off' or sluggish. Lightweight baseline snapshot."
                 :task tasks/snap!}
  heavy         {:doc "CAPTURE: OOM dialog appeared! Comprehensive snapshot (run before dismissing dialog)."
                 :task tasks/heavy!}
  reboot-log    {:doc "CAPTURE: After unexpected reboot. Grabs panic/watchdog logs (run within 2h of boot)."
                 :task tasks/reboot-log!}

  ;; === ANALYZE (read-only, no snapshots created) ===
  recipe:metrics {:doc "ANALYZE: Live swap/pressure/pageouts + historical trends. Start here for health check."
                  :task recipes/metrics!}
  recipe:panic  {:doc "ANALYZE: Panic/watchdog/jetsam events. Use after crashes or freezes."
                 :task recipes/panic!}
  recipe:reboot {:doc "ANALYZE: Shutdown cause analysis. Use after unexpected reboots."
                 :task recipes/reboot!}
  recipe:jetsam {:doc "ANALYZE: Kernel memory kills. Use when apps are force-quit by system."
                 :task recipes/jetsam!}
  inspect-process {:doc "ANALYZE: Process investigation. Usage: bb inspect-process <name> [--patterns] [--exclude] [--events] [--snapshots] [--limit]"
                   :task (process-inspect/inspect! *command-line-args*)}
  grep          {:doc "ANALYZE: Search all snapshots. Usage: bb grep \"pattern\" [glob]"
                 :task (tasks/grep-snaps! (first *command-line-args*)
                                          (second *command-line-args*))}
  summarize     {:doc "ANALYZE: Key metrics from newest snapshot."
                 :task tasks/summarize!}
  latest        {:doc "ANALYZE: Print path to newest snapshot."
                 :task tasks/latest}

  ;; === SCHEDULING ===
  schedule:install   {:doc "SCHEDULE: Enable auto-snapshots (lite every 6h, heavy daily 3am)."
                      :task tasks/schedule-install!}
  schedule:uninstall {:doc "SCHEDULE: Disable auto-snapshots."
                      :task tasks/schedule-uninstall!}
  schedule:status    {:doc "SCHEDULE: Check if launchd jobs are active."
                      :task tasks/schedule-status!}

  ;; === DEV ===
  test          {:doc "DEV: Run rich-comment-tests in scripts/"
                 :task (rct/run-tests-in-file-tree! {:dirs #{"scripts"}})}}}

