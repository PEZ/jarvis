#!/usr/bin/env bash
set -euo pipefail
ROOT="${HOME}/jarvis"
SNAPS="${ROOT}/snaps"
mkdir -p "$SNAPS"
TS="$(date +"%Y%m%d-%H%M%S")"
OUT="$SNAPS/lite-$TS.txt"
{
  echo "=== date ==="; date
  echo "=== uptime ==="; uptime
  echo "=== swap ==="; sysctl vm.swapusage
  echo "=== memory_pressure ==="; memory_pressure
  echo "=== vm_stat (key) ==="; vm_stat | egrep "wired|compress|free|pageouts|faults" || true
  echo "=== kern memory ==="; sysctl kern.memorystatus_level vm.page_free_count vm.page_speculative_count 2>/dev/null || true
  echo "=== shutdown cause ==="; log show --last 5m --predicate 'eventMessage CONTAINS "Previous shutdown cause"' --style compact 2>/dev/null | head -5 || true
  echo "=== disk / ==="; df -h /
  echo "=== top mem (head) ==="; (top -l 1 -o mem | head -25) || true
} > "$OUT"
echo "$OUT"
